# TODO List 项目说明文档

## 1. 技术选型

*   **编程语言**：C++
    *   **理由**：高性能，结合 Qt 框架可实现跨平台 GUI 开发。
*   **框架/库**：Qt 6 
    *   **理由**：成熟的跨平台桌面应用开发框架，提供丰富的 UI 组件和便捷的数据库操作接口。
*   **构建系统**：CMake
    *   **理由**：现代 C++ 项目的标准构建工具，支持跨平台构建配置。
*   **数据库/存储**：SQLite
    *   **理由**：
        *   **轻量级**：无需单独的服务器进程，适合桌面单机应用。
        *   **零配置**：数据库文件直接存储在用户数据目录，易于部署和迁移。
        *   **Qt 支持**：Qt 提供了完善的 `QSqlDatabase` 和 `QSqlQuery` 驱动支持。
*   **替代方案对比**：
    *   **vs 本地 JSON/XML 文件**：SQLite 支持 SQL 查询，方便进行复杂的筛选（如按日期、优先级）和排序，且在数据量增大时性能更好。
    *   **vs MySQL/PostgreSQL**：对于单用户桌面应用，部署全功能的数据库服务器过于笨重且增加了用户的配置成本。

## 2. 项目结构设计

本项目采用分层架构，将数据模型、数据访问和用户界面分离。

### 目录结构

```text
src/
  main.cpp                # 程序入口
  model/                  # 数据模型层
    taskitem.h/cpp        # 定义任务实体 (TaskItem)
  repo/                   # 数据仓库层
    databasemanager.h/cpp # 数据库管理，封装 SQLite 操作
  widget/                 # 视图/UI 层
    mainwindow.h/cpp      # 主窗口逻辑 (列表展示、排序、筛选)
    taskcreatedialog.h/cpp # 任务创建对话框
    taskdetaildialog.h/cpp # 任务详情/编辑对话框
    *.ui                  # Qt Designer 设计的界面文件
```

### 模块职责说明

*   **Model (`src/model`)**: 定义核心数据结构 `TaskItem`，包含 ID、标题、描述、完成状态、分类、优先级、截止日期等属性。
*   **Repository (`src/repo`)**: `DatabaseManager` 类采用单例模式，负责：
    *   数据库连接初始化 (`openDatabase`)。
    *   表结构初始化 (`initTable`)。
    *   CRUD 操作：增 (`addTask`)、删 (`removeTask`)、改 (`updateTask`)、查 (`getAllTasks`, `searchTasks`)。
    *   数据存储位置使用 `QStandardPaths::AppDataLocation`，确保符合操作系统规范。
*   **Widget (`src/widget`)**:
    *   `MainWindow`: 负责展示任务列表 (`QTableWidget`)，处理用户交互（排序、筛选、搜索），并协调 Model 和 Repository。
    *   `TaskCreateDialog` / `TaskDetailDialog`: 负责任务信息的输入和编辑。

## 3. 需求细节与决策

### 数据字段与校验
*   **标题 (Title)**: **必填**。数据库约束为 `NOT NULL`。
*   **描述 (Description)**: 选填。
*   **优先级 (Priority)**: 整数存储 (0: 低, 1: 中, 2: 高)。默认值为 0。
*   **截止日期 (Deadline)**: 选填。存储为 ISO 格式字符串。

### 交互逻辑
*   **任务展示**: 使用 `QTableWidget` 展示，第一列为复选框（表示完成状态），支持双击行进行编辑。
*   **排序逻辑**:
    *   支持按 **ID**、**标题**、**优先级**、**截止日期** 排序。
    *   支持 **升序/降序** 切换。
    *   *决策*：优先级排序时，高优先级 (2) 视为“大”值。截止日期排序时，无效日期排在最后。
*   **筛选功能**:
    *   **分类筛选**: 侧边栏 `QListWidget` 动态加载所有已有的分类供筛选。
    *   **状态筛选**: 全部 / 未完成 / 已完成。
    *   **过期筛选**: 全部 / 未过期 / 今年过期 / 本月过期 / 本周过期 / 今天过期 / 已过期。
*   **搜索**: 支持对 **标题** 和 **描述** 进行模糊搜索 (`LIKE %keyword%`)。

### 扩展功能设计
*   **数据持久化**: 每次应用启动时自动加载 SQLite 数据库，关闭时自动保存（实时写入）。
*   **复制功能**: 支持选中任务进行复制，方便创建重复性任务。

## 4. AI 使用说明

本项目在开发过程中使用了 AI 辅助工具（GitHub Copilot）。

### 使用 AI 的环节
1.  **代码脚手架生成**: 使用 AI 生成了 `TaskItem` 类定义和 `DatabaseManager` 的基础 CRUD SQL 语句，节省了编写样板代码的时间。
2.  **Qt 信号槽连接**: 辅助编写 `MainWindow` 中复杂的 UI 控件信号与槽函数的连接逻辑。
3.  **复杂逻辑实现**: 辅助实现了多重筛选逻辑（同时应用分类、完成状态、过期时间筛选）和排序比较器 (`std::sort` 的 lambda 表达式)。
4.  **文档编写**: 本文档由 AI 根据项目代码自动分析并生成初稿。

### AI 输出修改
*   *AI 建议*: 最初 AI 实现添加过期状态筛选选项，包括今年过期、本月过期、本周过期和今天过期，都没考虑到排除已过期项目。
*   *修改*: 修改过期状态筛选逻辑，确保筛选条件考虑未过期项。

## 5. 运行与测试方式

### 环境要求
*   **操作系统**: Windows (已测试), macOS, Linux
*   **编译器**: 支持 C++17 的编译器 (如 MinGW 64-bit)
*   **Qt 版本**: Qt 6.5 或更高版本 (本项目使用 Qt 6.8.3)
*   **构建工具**: CMake

### 本地运行方式
1.  **克隆项目**:
    ```bash
    git clone <repository_url>
    cd RememberMe
    ```
2.  **构建项目**:
    ```bash
    mkdir build
    cd build
    cmake ..
    cmake --build .
    ```
3.  **运行**:
    *   Windows: 运行 `build/Debug/todo-list.exe` (确保 Qt DLL 在路径中或使用 `windeployqt`)。

### 已知问题与不足
*   **UI 美化**: 目前使用原生 Qt 控件样式，未应用自定义 QSS，界面较为朴素。
*   **提醒功能**: 虽然有截止日期，但尚未实现系统级通知或弹窗提醒。
*   **性能**: 对于极大量数据（如 10万+ 条），全量加载到内存 (`QList`) 可能会导致启动变慢，未来可考虑分页加载 (`QSqlTableModel` 或 `fetchMore`)。

## 6. 总结与反思

### 亮点
*   **架构清晰**: 严格遵循了分层架构，数据库操作被完全封装在 `DatabaseManager` 中，UI 层不包含任何 SQL 语句。
*   **功能完备**: 实现了比基础 Todo List 更丰富的筛选（多维度）和排序功能，实用性强。
*   **健壮性**: 对数据库连接失败、空输入等异常情况进行了基本的错误处理 (`QMessageBox`)。

### 改进计划
如果有更多时间，我会：
1.  **引入提醒机制**: 使用 Qt 的系统托盘图标 (`QSystemTrayIcon`) 或平台特定的 API 实现到期提醒。
2.  **数据同步**: 引入网络模块，支持将数据同步到云端服务器。
3.  **UI/UX 升级**: 设计一套现代化的 UI 主题。
4.  **单元测试**: 为 `TaskItem` 和 `DatabaseManager` 编写单元测试，确保核心逻辑的稳定性。